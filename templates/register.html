<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>脑部肿瘤在线检测 - 注册</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="robots" content="all,follow">
	<!-- Bootstrap CSS-->
	<link rel="stylesheet" href="static/assets/vendor/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,700">
	<link rel="stylesheet" href="static/css/style.default.css" id="theme-stylesheet">
</head>

<body>
	<div class="page login-page">
		<div class="container d-flex align-items-center">
			<div class="form-holder has-shadow">
				<div class="row">
					<!-- Logo & Information Panel-->
					<div class="col-lg-6">
						<div class="info d-flex align-items-center">
							<div class="content">
								<div class="logo">
									<h1>脑部肿瘤在线检测</h1>
								</div>
								<p>欢迎注册</p>
							</div>
						</div>
					</div>
					<!-- Form Panel    -->
					<div class="col-lg-6 bg-white">
						<div class="form d-flex align-items-center">
							<div class="content">

								<div class="form-group">
									<input id="register-username" class="input-material" type="text"
										name="registerUsername" placeholder="请输入真实姓名">
									<div class="invalid-feedback">
										用户名必须在2~10位之间
									</div>
								</div>

								<div class="form-group">
									<input id="register-id-no" class="input-material" type="text"
										name="registerIdNo" placeholder="请输入身份号">
									<div class="invalid-feedback">
										身份号格式有误
									</div>
								</div>

								<div class="form-group">
									<input id="register-email" class="input-material" type="text"
										name="registerEmail" placeholder="请输入邮箱">
									<div class="invalid-feedback">
										邮箱格式不对，如 a@btd.com
									</div>
								</div>

								<div class="form-group">
									<input id="register-age" class="input-material" type="text"
										name="registerAge" placeholder="请输入年龄">
									<div class="invalid-feedback">
										年龄 1 ~ 120 之间有效
									</div>
								</div>

								<div class="from-group">
									<div class="form-check form-check-inline">
										<input class="form-check-input" type="radio" name="registerSexOptions"
											id="register-sex-m" value="M" checked>
										<label class="form-check-label" for="inlineRadio1">男</label>
									</div>
									<div class="form-check form-check-inline">
										<input class="form-check-input" type="radio" name="registerSexOptions"
											id="register-sex-w" value="W">
										<label class="form-check-label" for="inlineRadio2">女</label>
									</div>
								</div>


								<div class="form-group">
									<input id="register-password" class="input-material" type="password"
										name="registerPassword" placeholder="请输入密码">
									<div class="invalid-feedback">
										密码必须在6~10位之间
									</div>
								</div>
								<div class="form-group">
									<input id="register-passwords" class="input-material" type="password"
										name="registerPasswords" placeholder="确认密码">
									<div class="invalid-feedback">
										两次密码必须相同 且在6~10位之间
									</div>
								</div>


								<div class="form-group">
									<button id="regbtn" type="button" name="registerSubmit"
										class="btn btn-primary">注册</button>
								</div>
								<small>已有账号?</small><a href="/login" class="signup">&nbsp;登录</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- JavaScript files-->
	<script src="static/js/jquery-1.10.2.min.js"></script>
	<script src="static/js/bootstrap-4.2.1.min.js"></script>
	<script>
		$(function () {

			/*错误class  form-control is-invalid
			正确class  form-control is-valid*/
			var flagName = false;
			var flagIdNo = false;
			var flagEmail = false;
			var flagAge = false;
			var flagPas = false;
			var flagPass = false;

			/*验证用户名*/
			var name, idNo, email, age, sex, passWord, passWords;

			$("#register-username").change(function () {
				name = $("#register-username").val();
				if (name.length < 2 || name.length > 10) {
					$("#register-username").removeClass("form-control is-valid")
					$("#register-username").addClass("form-control is-invalid");
					flagName = false;
				} else {
					$("#register-username").removeClass("form-control is-invalid")
					$("#register-username").addClass("form-control is-valid");
					flagName = true;
				}
			})

			$("#register-id-no").change(function () {
				idNo = $("#register-id-no").val();
				// 身份证号码为15位或者18位，15位时全为数字，
				// 18位前17位为数字，最后一位是校验位，可能为数字或字符X。
				var idNoRegex = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
				if (!idNoRegex.test(idNo)) {
					$("#register-id-no").removeClass("form-control is-valid")
					$("#register-id-no").addClass("form-control is-invalid");
					flagIdNo = false;
				} else {
					$("#register-id-no").removeClass("form-control is-invalid")
					$("#register-id-no").addClass("form-control is-valid");
					flagIdNo = true;
				}
			})

			$("#register-email").change(function () {
				email = $("#register-email").val();
				// 身份证号码为15位或者18位，15位时全为数字，
				// 18位前17位为数字，最后一位是校验位，可能为数字或字符X。
				var emailRegex = /^[a-z0-9]+@[a-z]+\.[a-z]{2,3}$/;
				if (!emailRegex.test(email)) {
					$("#register-email").removeClass("form-control is-valid")
					$("#register-email").addClass("form-control is-invalid");
					flagEmail = false;
				} else {
					$("#register-email").removeClass("form-control is-invalid")
					$("#register-email").addClass("form-control is-valid");
					flagEmail = true;
				}
			})


			
			$("#register-age").change(function () {
				age = $("#register-age").val();
				// 年龄 1 ~ 120 之间有效
				// 18位前17位为数字，最后一位是校验位，可能为数字或字符X。
				var ageRegex = /^(?:[1-9][0-9]?|1[01][0-9]|120)/;
				if (!ageRegex.test(age)) {
					$("#register-age").removeClass("form-control is-valid")
					$("#register-age").addClass("form-control is-invalid");
					flagAge = false;
				} else {
					$("#register-age").removeClass("form-control is-invalid")
					$("#register-age").addClass("form-control is-valid");
					flagAge = true;
				}
			})

			/*验证密码*/
			$("#register-password").change(function () {
				passWord = $("#register-password").val();
				if (passWord.length < 6 || passWord.length > 18) {
					$("#register-password").removeClass("form-control is-valid")
					$("#register-password").addClass("form-control is-invalid");
					flagPas = false;
				} else {
					$("#register-password").removeClass("form-control is-invalid")
					$("#register-password").addClass("form-control is-valid");
					flagPas = true;
				}
			})

			/*验证确认密码*/
			$("#register-passwords").change(function () {
				passWords = $("#register-passwords").val();
				if ((passWord != passWords) || (passWords.length < 6 || passWords.length > 18)) {
					$("#register-passwords").removeClass("form-control is-valid")
					$("#register-passwords").addClass("form-control is-invalid");
					flagPass = false;
				} else {
					$("#register-passwords").removeClass("form-control is-invalid")
					$("#register-passwords").addClass("form-control is-valid");
					flagPass = true;
				}
			})


			var tesObj = document.getElementsByName("registerSexOptions");
			//获取选中的值
			for(var i=0; i < tesObj.length; i++){
				if (tesObj[i].checked==true){
					sex = tesObj[i].value;
					break;
				}
			}

			$("#regbtn").click(function () {
				if (flagName && flagPas && flagPass && flagIdNo && flagEmail && flagAge) {
					localStorage.setItem("name", name);
					localStorage.setItem("passWord", passWord);
					localStorage.setItem("idNo", idNo);
					localStorage.setItem("email", email);
					localStorage.setItem("age", age);
					localStorage.setItem("sex", sex);

					
					// $.get('http://127.0.0.1:5000/register/' + name + '/' + idNo + "/" + email + "/" + email + "/" + age + "/" + sex + "/" + passWord, {},
					// 	function(data) {
					// 		alert(data['info'])
					// 		if(data['status'] == 'ok') {
					// 			window.location.href = "/login.html"
					// 		} else {
					// 			window.location.href = "/"
					// 		}
					// 	}
					// );
					const url = "http://127.0.0.1:5000/register";
					const data = {
						"name": name,
						"password": passWord,
						"idNo": idNo,
					    "email": email,
                        "age": age,
						"sex": sex     
					}
					$.post(url, data, function(data, status) {
						// alert(data['info'])
						if(data['status'] == 'ok') {
							window.location.href = "/login"
					    } else {
							window.location.href = "/"
						}
					})
				} else {
					if (!flagName) {
						$("#register-username").addClass("form-control is-invalid");
					}
					if (!flagIdNo) {
						$("#register-id-no").addClass("form-control is-invalid");
					}
					if (!flagEmail) {
						$("#register-email").addClass("form-control is-invalid");
					}
					if (!flagAge) {
						$("#register-age").addClass("form-control is-invalid");
					}
					if (!flagPas) {
						$("#register-password").addClass("form-control is-invalid");
					}
					if (!flagPass) {
						$("#register-passwords").addClass("form-control is-invalid");
					}
				}
			})
		})
	</script>
</body>

</html>